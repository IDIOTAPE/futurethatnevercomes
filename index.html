<!doctype html>
<html lang="en">
<head>
	<title>Leaflet Provider Demo</title>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
	<!-- Leaflet style. REQUIRED! -->
	<link rel="stylesheet" href="http://unpkg.com/leaflet@1.0.3/dist/leaflet.css" />
	<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
	<style>
		html { height: 100% }
		body { height: 100%; margin: 0; padding: 0;}
		.map { height: 100% }
	</style>
	<!--Fork Me on Github ribbon, we're using the awsome version from simonwhitaker available at https://github.com/simonwhitaker/github-fork-ribbon-css  -->
	<link rel="stylesheet" href="css/gh-fork-ribbon.css" />
	<!--[if IE]>
		<link rel="stylesheet" href="css/gh-fork-ribbon.ie.css" />
	<![endif]-->
</head>
<body>
	<div class="github-fork-ribbon-wrapper left">
		<div class="github-fork-ribbon">
			<a href="https://github.com/leaflet-extras/leaflet-providers">Fork me on GitHub</a>
		</div>
	</div>
	<div id="map" class="map"></div>
	<script src="http://unpkg.com/leaflet@1.0.3/dist/leaflet.js"></script>
	<script src="leaflet-providers.js"></script>
	<script src="bounce.js"></script>
	<script>
		var map = L.map('map', {
			center: [37.2336805,-115.8101785],
			zoom: 7,
			zoomControl: false
		});

		var defaultLayer = L.tileLayer.provider('Esri.WorldImagery').addTo(map);

		var baseLayers = {
			'OpenStreetMap Default': defaultLayer,
			'OpenStreetMap German Style': L.tileLayer.provider('OpenStreetMap.DE'),
			'OpenStreetMap H.O.T.': L.tileLayer.provider('OpenStreetMap.HOT'),
			'Thunderforest OpenCycleMap': L.tileLayer.provider('Thunderforest.OpenCycleMap'),
			'Thunderforest Transport': L.tileLayer.provider('Thunderforest.Transport'),
			'Thunderforest Landscape': L.tileLayer.provider('Thunderforest.Landscape'),
			'Hydda Full': L.tileLayer.provider('Hydda.Full'),
			'Stamen Toner': L.tileLayer.provider('Stamen.Toner'),
			'Stamen Terrain': L.tileLayer.provider('Stamen.Terrain'),
			'Stamen Watercolor': L.tileLayer.provider('Stamen.Watercolor'),
			'Jawg Streets': L.tileLayer.provider('Jawg.Streets'),
			'Jawg Terrain': L.tileLayer.provider('Jawg.Terrain'),
			'Esri WorldStreetMap': L.tileLayer.provider('Esri.WorldStreetMap'),
			'Esri DeLorme': L.tileLayer.provider('Esri.DeLorme'),
			'Esri WorldTopoMap': L.tileLayer.provider('Esri.WorldTopoMap'),
			'Esri WorldImagery': L.tileLayer.provider('Esri.WorldImagery'),
			'Esri WorldTerrain': L.tileLayer.provider('Esri.WorldTerrain'),
			'Esri WorldShadedRelief': L.tileLayer.provider('Esri.WorldShadedRelief'),
			'Esri WorldPhysical': L.tileLayer.provider('Esri.WorldPhysical'),
			'Esri OceanBasemap': L.tileLayer.provider('Esri.OceanBasemap'),
			'Esri NatGeoWorldMap': L.tileLayer.provider('Esri.NatGeoWorldMap'),
			'Esri WorldGrayCanvas': L.tileLayer.provider('Esri.WorldGrayCanvas'),
			'Geoportail France Maps': L.tileLayer.provider('GeoportailFrance'),
			'Geoportail France Orthos': L.tileLayer.provider('GeoportailFrance.orthos'),
			'Geoportail France classic maps': L.tileLayer.provider('GeoportailFrance.ignMaps')
		};

		var overlayLayers = {
			'OpenSeaMap': L.tileLayer.provider('OpenSeaMap'),
			'OpenWeatherMap Clouds': L.tileLayer.provider('OpenWeatherMap.Clouds'),
			'OpenWeatherMap CloudsClassic': L.tileLayer.provider('OpenWeatherMap.CloudsClassic'),
			'OpenWeatherMap Precipitation': L.tileLayer.provider('OpenWeatherMap.Precipitation'),
			'OpenWeatherMap PrecipitationClassic': L.tileLayer.provider('OpenWeatherMap.PrecipitationClassic'),
			'OpenWeatherMap Rain': L.tileLayer.provider('OpenWeatherMap.Rain'),
			'OpenWeatherMap RainClassic': L.tileLayer.provider('OpenWeatherMap.RainClassic'),
			'OpenWeatherMap Pressure': L.tileLayer.provider('OpenWeatherMap.Pressure'),
			'OpenWeatherMap PressureContour': L.tileLayer.provider('OpenWeatherMap.PressureContour'),
			'OpenWeatherMap Wind': L.tileLayer.provider('OpenWeatherMap.Wind'),
			'OpenWeatherMap Temperature': L.tileLayer.provider('OpenWeatherMap.Temperature'),
			'OpenWeatherMap Snow': L.tileLayer.provider('OpenWeatherMap.Snow'),
			'Geoportail France Parcels': L.tileLayer.provider('GeoportailFrance.parcels')
		};

L.control.layers(baseLayers, overlayLayers, {collapsed: false}).addTo(map);


var latLng_array = []
var marker_array = []
var icon_array = []
var pos_array = []
var marker_counter = 100
var timeout_counter = marker_counter
for (var i = 100; i >= 0; i--) {
	icon_array.push( L.icon({
   		iconUrl: 'tower/Untitled'+pad_with_zeroes(i, 4)+'.png',
   		shadowUrl: 'tower/Untitled'+pad_with_zeroes(i, 4)+'.png',

   		iconSize:     [200, 200], // size of the icon
   		shadowSize:   [200, 200], // size of the shadow
   		iconAnchor:   [100, 100], // point of the icon which will correspond to marker's location
   		shadowAnchor: [100, 100],  // the same for the shadow
   		popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
	})); 
}
function pad_with_zeroes(number, length) {
    var my_string = '' + number;
    while (my_string.length < length) {
        my_string = '0' + my_string;
    }
    return my_string;
}
for (var i = 100; i >= 0; i--) {
	latLng_array.push(new L.latLng([36.75+(i/50), -116.45+(i/50)]));
}

	setTimeout(function(){
		if(timeout_counter>= 0){
			marker_counter--
			marker_array.push(L.marker(latLng_array[i],{
			icon: icon_array[i],
		    	bounceOnAdd: true,
		    	bounceOnAddOptions: {duration: 500, height: 100, loop: 1}
		    }))
		    	console.log(marker_array)
		    	console.log(i)
		    if(i==0){
				for (var j = marker_array.length - 1; j >= 0; j--) {
					marker_array[j].addTo(map)
				}
		    }
		}
		
    },0)


for (var i = 100; i >= 0; i--) {
  delay(i)
}
function delay(i) {
  setTimeout(() => {
		if(timeout_counter>= 0){
			marker_counter--
			marker_array.push(L.marker(latLng_array[i],{
			draggable:'true',
			icon: icon_array[i],
		    	bounceOnAdd: true,
		    	bounceOnAddOptions: {duration: 500, height: 100, loop: 1}
		    }).addTo(map))
		    	console.log(marker_array)
		    	console.log(i)
		}

			for (var k = marker_array.length - 1; k >= 0; k--) {
				marker_array[k].setZIndexOffset(100000 - pos_array[k].y*10);
			}
  }, (100-i)*100);
}

map.on('zoomend', adjustZindex);
adjustZindex();

// adjust zIndex
function adjustZindex() {
	pos_array = []
	for (var i = 100; i >= 0; i--) {
		pos_array.push(map.latLngToLayerPoint(latLng_array[i]).round());
		if(i==0){
			console.log(pos_array[i])
			for (var k = marker_array.length - 1; k >= 0; k--) {
				marker_array[k].setZIndexOffset(1000 - pos_array[k].y);
			}
		}
	}
}





map.on('click', function(e) {
    location.hash = e.latlng.lat + ", " + e.latlng.lng
    console.log(e.latlng.lat + ", " + e.latlng.lng)
});
		// resize layers control to fit into view.
		function resizeLayerControl () {
			var layerControlHeight = document.body.clientHeight - (10 + 50);
			var layerControl = document.getElementsByClassName('leaflet-control-layers-expanded')[0];

			layerControl.style.overflowY = 'auto';
			layerControl.style.maxHeight = layerControlHeight + 'px';
		}
		map.on('resize', resizeLayerControl);
		resizeLayerControl();
	</script>
</body>
</html>
